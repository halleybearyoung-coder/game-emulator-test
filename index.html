<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CHIP-8 Emulator</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:20px;color:#111}
  header{display:flex;align-items:center;gap:12px}
  canvas{image-rendering:pixelated;border:1px solid #222; background:#000;}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button,input,select{padding:6px 8px;border-radius:6px;border:1px solid #bbb;background:#fafafa}
  label{font-size:14px}
  .status{margin-left:8px;font-size:13px;color:#555}
  #kbdmap{margin-top:12px;font-size:13px;color:#444}
  .small{font-size:13px}
</style>
</head>
<body>
<header>
  <h1 style="margin:0;font-size:18px">CHIP-8 Emulator</h1>
  <div class="status" id="status">Stopped</div>
</header>

<main>
  <canvas id="screen" width="64" height="32"></canvas>

  <div class="controls">
    <input type="file" id="romfile" accept=".ch8,.rom"/>
    <button id="runBtn">Run</button>
    <button id="pauseBtn">Pause</button>
    <button id="stepBtn">Step</button>
    <button id="resetBtn">Reset</button>
    <label class="small">Speed:
      <select id="speed">
        <option value="300">300 Hz</option>
        <option value="500" selected>500 Hz</option>
        <option value="1000">1000 Hz</option>
      </select>
    </label>
    <label class="small">Scale:
      <select id="scale">
        <option value="4">4×</option>
        <option value="6" selected>6×</option>
        <option value="8">8×</option>
      </select>
    </label>
    <div class="status" id="fps">—</div>
  </div>

  <div id="kbdmap">
    Keyboard → CHIP-8 keys: <br/>
    1 2 3 4 → 1 2 3 C &nbsp;&nbsp; Q W E R → 4 5 6 D &nbsp;&nbsp; A S D F → 7 8 9 E &nbsp;&nbsp; Z X C V → A 0 B F
    <div style="margin-top:6px;color:#666;font-size:13px">Tip: Drag & drop a .ch8 file onto the page or use the file input.</div>
  </div>
</main>

<script>
/* ----- CHIP-8 Emulator (minimal, complete) ----- */
/* CPU & VM state */
class CHIP8 {
  constructor() {
    this.reset();
  }
  reset(){
    this.memory = new Uint8Array(4096);
    this.V = new Uint8Array(16);
    this.I = 0;
    this.pc = 0x200;
    this.stack = [];
    this.delayTimer = 0;
    this.soundTimer = 0;
    this.display = new Uint8Array(64*32);
    this.keys = new Array(16).fill(false);
    this.drawFlag = true;
    this.paused = true;
    // load fontset
    const font = [
      0xF0,0x90,0x90,0x90,0xF0, // 0
      0x20,0x60,0x20,0x20,0x70, // 1
      0xF0,0x10,0xF0,0x80,0xF0, // 2
      0xF0,0x10,0xF0,0x10,0xF0, // 3
      0x90,0x90,0xF0,0x10,0x10, // 4
      0xF0,0x8

    
